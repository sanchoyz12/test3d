/* by abeto - https://abeto.co */
(function(){"use strict";const f={enabled:!1,files:{},add:function(o,t){this.enabled!==!1&&(this.files[o]=t)},get:function(o){if(this.enabled!==!1)return this.files[o]},remove:function(o){delete this.files[o]},clear:function(){this.files={}}};class E{constructor(t,s,c){const r=this;let n=!1,a=0,h=0,l;const e=[];this.onStart=void 0,this.onLoad=t,this.onProgress=s,this.onError=c,this.abortController=new AbortController,this.itemStart=function(i){h++,n===!1&&r.onStart!==void 0&&r.onStart(i,a,h),n=!0},this.itemEnd=function(i){a++,r.onProgress!==void 0&&r.onProgress(i,a,h),a===h&&(n=!1,r.onLoad!==void 0&&r.onLoad())},this.itemError=function(i){r.onError!==void 0&&r.onError(i)},this.resolveURL=function(i){return l?l(i):i},this.setURLModifier=function(i){return l=i,this},this.addHandler=function(i,d){return e.push(i,d),this},this.removeHandler=function(i){const d=e.indexOf(i);return d!==-1&&e.splice(d,2),this},this.getHandler=function(i){for(let d=0,L=e.length;d<L;d+=2){const m=e[d],w=e[d+1];if(m.global&&(m.lastIndex=0),m.test(i))return w}return null},this.abort=function(){return this.abortController.abort(),this.abortController=new AbortController,this}}}const A=new E;class g{constructor(t){this.manager=t!==void 0?t:A,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(t,s){const c=this;return new Promise(function(r,n){c.load(t,r,s,n)})}parse(){}setCrossOrigin(t){return this.crossOrigin=t,this}setWithCredentials(t){return this.withCredentials=t,this}setPath(t){return this.path=t,this}setResourcePath(t){return this.resourcePath=t,this}setRequestHeader(t){return this.requestHeader=t,this}abort(){return this}}g.DEFAULT_MATERIAL_NAME="__DEFAULT";const u=new WeakMap;class p extends g{constructor(t){super(t),this.isImageBitmapLoader=!0,typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"},this._abortController=new AbortController}setOptions(t){return this.options=t,this}load(t,s,c,r){t===void 0&&(t=""),this.path!==void 0&&(t=this.path+t),t=this.manager.resolveURL(t);const n=this,a=f.get(`image-bitmap:${t}`);if(a!==void 0){if(n.manager.itemStart(t),a.then){a.then(e=>{if(u.has(a)===!0)r&&r(u.get(a)),n.manager.itemError(t),n.manager.itemEnd(t);else return s&&s(e),n.manager.itemEnd(t),e});return}return setTimeout(function(){s&&s(a),n.manager.itemEnd(t)},0),a}const h={};h.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",h.headers=this.requestHeader,h.signal=typeof AbortSignal.any=="function"?AbortSignal.any([this._abortController.signal,this.manager.abortController.signal]):this._abortController.signal;const l=fetch(t,h).then(function(e){return e.blob()}).then(function(e){return createImageBitmap(e,Object.assign(n.options,{colorSpaceConversion:"none"}))}).then(function(e){return f.add(`image-bitmap:${t}`,e),s&&s(e),n.manager.itemEnd(t),e}).catch(function(e){r&&r(e),u.set(l,e),f.remove(`image-bitmap:${t}`),n.manager.itemError(t),n.manager.itemEnd(t)});f.add(`image-bitmap:${t}`,l),n.manager.itemStart(t)}abort(){return this._abortController.abort(),this._abortController=new AbortController,this}}const b=new p;b.setOptions({premultiplyAlpha:"none",imageOrientation:"flipY"});const C=new p;C.setOptions({premultiplyAlpha:"none",imageOrientation:"none"}),onmessage=o=>{const{id:t}=o.data;(o.data.flipY?b:C).load(o.data.url,s=>{postMessage({id:t,bitmap:s},[s])},null,()=>{postMessage({id:t,error:!0})})}})();
